pub static frag_shader_src : &'static str = "
#version 330 core
#define steps 165.0
const int v=80;const float f=1280,o=720;uniform float iTime;uniform vec4 spheres[(v+2)*2];uniform sampler2D terrain;in vec4 gl_FragCoord;out vec4 fragColor;const vec3 x=normalize(vec3(1.,1.1,1.));const float e=99999.;vec2 s[4]=vec2[4](normalize(vec2(.23,.6556)),normalize(vec2(.83,-.26)),normalize(vec2(.13,-.826)),normalize(vec2(-.2,.55)));vec3 t(vec3 v){float f=0.,o=0.;for(int i=0;i<4;i++){float e=v.x*s[i].x+v.z*s[i].y;e=e*(4.-float(i)*.51013)+iTime;float r=1./(float(i)+1.);f+=r*sin(e-.3*cos(e));o+=r*cos(e-.3*sin(e));}return vec3(f,0.,o);}float t(vec3 v,vec3 f,float i,out vec3 r,out vec3 x){if(v.y>=0.)return e;float s=(i-f.y)/v.y;x=vec3(0.,1.f,0.f);r=f+v*s;return s;}float t(float v,vec3 f,vec3 e,vec3 x,float i,int s,out vec3 r,out vec3 o,out int c){vec3 z=x-e;float n=dot(z,f);if(n<0.)return v;else{float t=length(z),y=t*t-n*n;if(y>i)return v;else{float d=sqrt(i-y),k=n-d;if(k<v)return r=e+k*f,o=normalize(r-x),c=s,k;else return v;}}}bool t(vec3 v,vec3 f,vec3 s,float x){vec3 i=s-f;float e=dot(i,v);if(e<0.)return false;else{float r=length(i),o=r*r-e*e;if(o>x)return false;else return true;}}float t(vec2 f,out float v){f+=vec2(270.,252.);vec4 r=texture(terrain,f/512.);v=r.x*5.;return r.x*60.-12.1;}void t(vec3 v,vec3 f,out float r,out float o,out float s,out vec3 x,out float i,out float e,out float c,out vec3 z){vec3 t=f-v;if(t.x>0.)r=1.,o=1./t.x,s=o*(1.-fract(v.x)),x=vec3(-1.,0,0);else r=-1.,o=1./-t.x,s=o*fract(v.x),x=vec3(1.,0,0);if(t.z>0.)i=1.,e=1./t.z,c=e*(1.-fract(v.z)),z=vec3(0,0,-1.);else i=-1.,e=1./-t.z,c=e*fract(v.z),z=vec3(0,0,1.);}bool t(vec3 v,vec3 f,float e,out float i,out vec3 r,out vec3 o,out float x){vec3 c=f-v;float s,z,n;vec3 d;float k,y,p;vec3 m;t(v,f,s,z,n,d,k,y,p,m);float l=floor(v.x),w=floor(v.z),a=0.,u=v.y,g,b=t(vec2(l,w),g);x=0.;for(float h=0.;h<e;h++){if(n<p)i=n,a=v.y+c.y*n,n=n+z,l=l+s,o=d;else i=p,a=v.y+c.y*p,p=p+y,w=w+k,o=m;if(b>a){r=vec3(g/40.,g/40.,1.);if(g<=2.5)r=vec3(.2,.071,.01),x=1.1;else r=vec3(.8,.01,.01),x=1.5;o=vec3(0,1.,0);i=(b-v.y)/c.y;return true;}b=t(vec2(l,w),g);if(b>a){r=vec3(g,g,1.);if(g>=3.5)r=vec3(.2,.171,.01),x=1.5;else r=vec3(.8,.01,.01),x=1.5;return true;}}return false;}float t(float v,vec3 f,vec3 o){float e=(1.-v)/(1.+v);e*=e;float r=-dot(f,o),s=1.-r,x=e+(1.-e)*s*s*s*s*s;return x;}const vec3 i=vec3(5e-06,1.5e-05,.00027)*15.,c=vec3(.00015,.00015,.00027)*15.;vec3 r(float v){return exp(-v*(i+c));}vec3 r(float v,float f){vec3 r=4.*vec3(27.,4.,1.)/pow(v*10.,4.);return r;}vec3 n(float v,float f){float r=.0003/16.*3.14159*(1.+f*f);vec3 s=vec3(1./(i.x+c.x)*(1.-exp(-v*c.x)),1./(i.y+c.y)*(1.-exp(-v*c.y)),1./(i.z+c.z)*(1.-exp(-v*c.z)));float x=.476;vec3 e=vec3(.002,.0008,.0002)*(1.-x)*(1.-x)/(12.5664*pow(1.+x*x-2.*x*f,1.5));float o=20./(i.x+c.x)*(1.-exp(-v*c.x));return r*s+e*o;}void main(){float i=iTime*2.,s=(30.*i-45.*cos(i)+cos(3.*i)-9.*sin(2.*i))/96.;s+=iTime*.1;vec2 z=2.*(gl_FragCoord.xy/o)-vec2(f/o,1.);vec3 c=vec3(z,-2.),p=vec3(0.,0.,0.);float g=spheres[161].y;mat3 m=mat3(cos(g),0,-sin(g),0,1,0,sin(g),0,cos(g));float y=spheres[161].x;mat3 d=mat3(1,0,0,0,cos(y),-sin(y),0,sin(y),cos(y));m=m*d;vec3 l=spheres[160].xyz,w=m*p,b=m*c;w+=l;b+=l;vec3 k=normalize(b-w);float u=1.;vec3 h=vec3(0,0,0);for(int a=2;a>0;a--){vec3 T,C,F,D;float q,Z=0.;int Y=-1;float X=e,W=0.;D=vec3(1.,1.,0.);for(int V=0;V<v;V++)X=t(X,k,w,spheres[V*2].xyz,spheres[V*2].w,V,F,C,Y);if(Y!=-1)D=spheres[Y*2+1].xyz,q=spheres[Y*2+1].w,Z=t(q,C,k),T=reflect(k,C);vec3 V=w+k;float U;vec3 S,R;float Q;if(t(w,V,steps,U,S,R,Q)){if(U<X)X=U,D=S,C=R,q=Q,F=w+k*X*.9999,Z=t(q,C,k),T=reflect(normalize(k),C);}vec3 P;float O=t(k,w,-.5,P,R);if(O<=X)X=O,q=1.7,D=vec3(.05,.05,.05),F=w+k*X*.9999,C=R+t(F)*.005,C=normalize(C),Z=t(q,C,k),T=reflect(k,C),Y=0;vec3 N=vec3(0,0,0);if(X>=e){N+=n(X,dot(x,k));h+=N*u;break;}for(int M=0;M<1;M++){bool L=false;vec3 K,J;float I;vec3 H=F+x*5.;if(!L){for(int G=0;G<v;G++){if(t(x,F,spheres[G*2].xyz,spheres[G*2].w)){L=true;break;}}}if(!L){vec3 G=reflect(-x,C),E=-k;float B=dot(x,C);vec3 A=normalize(E+x);float j=pow(dot(C,A),121.);j=clamp(j,0.,1.);vec3 ab=D*B;N+=vec3(j,j,j)+ab;}else N+=D*.02;}N*=r(X);if(Y!=0)N+=r(X,dot(x,k));N+=n(X,dot(x,k));h+=N*u*(1.-Z);u=u*Z;k=T;w=F;}vec3 X=pow(h,vec3(1./2.2));fragColor=vec4(X,1.);}\0\0";
